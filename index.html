<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>AsciiTrack - Keyboard Checker</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; padding: 20px; text-align: center; }
        h1 { color: #38bdf8; margin-bottom: 5px; }
        .stats { color: #94a3b8; margin-bottom: 20px; font-size: 0.9rem; }
        
        .container { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; max-width: 1100px; margin: 0 auto; }
        
        .key-box {
            border: 1px solid #1e293b;
            padding: 10px;
            width: 65px;
            border-radius: 8px;
            /* æœ€åˆã¯æ¿ƒã„èƒŒæ™¯è‰² */
            background: #1e293b;
            color: #f8fafc;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        /* æ‰“ã£ãŸå¾Œã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè–„ãã™ã‚‹ï¼‰ */
        .key-box.pressed {
            background: rgba(30, 41, 59, 0.2);
            color: #475569;
            border-color: #334155;
        }

        /* å©ã„ãŸç¬é–“ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åŠ¹æœ */
        .key-box.active {
            background: #38bdf8 !important;
            color: #0f172a !important;
            transform: scale(0.95);
            box-shadow: 0 0 15px #38bdf8;
        }

        .code { font-size: 0.65rem; color: #64748b; display: block; }
        .char { font-size: 1.1rem; font-weight: bold; display: block; margin: 4px 0; }
        .count { font-size: 0.75rem; opacity: 0.6; }

        /* ç‰¹æ®Šã‚­ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .special { border-color: #334155; width: 90px; }
    </style>
</head>
<body>

    <h1>AsciiTrack</h1>
    <div class="stats" id="status-text">ã™ã¹ã¦ã®ã‚­ãƒ¼ã‚’æ‰“ã¡æŠœã“ã†ï¼</div>
    
    <div class="container" id="key-container">
        </div>

    <script>
        const container = document.getElementById('key-container');
        const keyMap = {};

        // 1. ç‰¹æ®Šã‚­ãƒ¼ã®å®šç¾©
        const specialKeys = [
            { code: 8, name: 'BS', label: 'Backspace' },
            { code: 13, name: 'Enter', label: 'Enter' },
            { code: 46, name: 'Del', label: 'Delete' }
        ];

        // å…±é€šã®ç”Ÿæˆé–¢æ•°
        function createKeyElement(id, charName, label) {
            const div = document.createElement('div');
            div.className = 'key-box';
            if (isNaN(id)) div.classList.add('special');
            div.id = `key-${id}`;
            div.innerHTML = `
                <span class="code">${label}</span>
                <span class="char">${charName}</span>
                <span class="count" id="count-${id}">0</span>
            `;
            container.appendChild(div);
            
            keyMap[id] = { count: 0, element: div, countElement: document.getElementById(`count-${id}`) };
        }

        // ç‰¹æ®Šã‚­ãƒ¼ã®ä½œæˆ
        specialKeys.forEach(k => createKeyElement(k.name, k.name, 'CTRL'));

        // ASCII 32-126 ã®ä½œæˆ
        for (let i = 32; i <= 126; i++) {
            const char = i === 32 ? 'Space' : String.fromCharCode(i);
            createKeyElement(i, char, `ID: ${i}`);
        }

        let totalPressed = 0;
        const totalTargets = Object.keys(keyMap).length;

        window.addEventListener('keydown', (event) => {
            let targetId = null;

            // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            if (event.key === 'Backspace') targetId = 'BS';
            else if (event.key === 'Enter') targetId = 'Enter';
            else if (event.key === 'Delete') targetId = 'Del';
            else if (event.key.length === 1) {
                const code = event.key.charCodeAt(0);
                if (code >= 32 && code <= 126) targetId = code;
            }

            if (targetId && keyMap[targetId]) {
                const data = keyMap[targetId];
                
                // åˆå›å…¥åŠ›æ™‚ã®å‡¦ç†
                if (data.count === 0) {
                    totalPressed++;
                    data.element.classList.add('pressed');
                }

                data.count++;
                data.countElement.innerText = data.count;

                // å©ã„ãŸç¬é–“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                data.element.classList.add('active');
                setTimeout(() => data.element.classList.remove('active'), 100);

                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                document.getElementById('status-text').innerText = 
                    `Progress: ${totalPressed} / ${totalTargets} keys tracked`;

                if (totalPressed === totalTargets) {
                    document.getElementById('status-text').innerText = "ğŸ‰ All Keys Tracked! Perfect!";
                    document.getElementById('status-text').style.color = "#fbbf24";
                }

                // BSãªã©ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œï¼ˆå‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ç­‰ï¼‰ã‚’é˜²æ­¢
                if (['Backspace', 'Delete'].includes(event.key)) event.preventDefault();
            }
        });
    </script>
</body>
</html>